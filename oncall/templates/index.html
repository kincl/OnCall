<!DOCTYPE html>
<html>
<head>
<link href='{{ url_for('static', filename='fullcalendar/fullcalendar/fullcalendar.css') }}' rel='stylesheet' />
<!--<link href='{{ url_for('static', filename='fullcalendar/fullcalendar/fullcalendar.print.css') }}' rel='stylesheet' media='print' />-->
<script src='{{ url_for('static', filename='fullcalendar/lib/jquery.min.js') }}'></script>
<script src='{{ url_for('static', filename='fullcalendar/lib/jquery-ui.custom.min.js') }}'></script>
<script src='{{ url_for('static', filename='fullcalendar/fullcalendar/fullcalendar.min.js') }}'></script>
<script>
    $(document).ready(function() {
        // Set up calendar
        $('#calendar').fullCalendar({
            editable: true,
            droppable: true,
            events: "/get_events",
            
            eventDrop: function(event, delta) {
                console.log(event);
            },

            drop: function(date, allDay) { // this function is called when something is dropped
            
                // retrieve the dropped element's stored Event Object
                var originalEventObject = $(this).data('eventObject');
                
                // we need to copy it, so that multiple events don't have a reference to the same object
                var copiedEventObject = $.extend({}, originalEventObject);
                
                // assign it the date that was reported
                copiedEventObject.start = date;
                copiedEventObject.allDay = allDay;
                
                // render the event on the calendar
                // the last `true` argument determines if the event "sticks" (http://arshaw.com/fullcalendar/docs/event_rendering/renderEvent/)
                $('#calendar').fullCalendar('renderEvent', copiedEventObject, true);
                
            },
            
            loading: function(bool) {
                if (bool) $('#loading').show();
                else $('#loading').hide();
            }
        });

        // Set up team
        $.getJSON( "/get_team_members/team1", function( data ) {
            var items = [];
            $.each( data, function( key, val ) {
                var member = $("<div/>", {
                                            "class": "team_member",
                                            "id": val['id'],
                                            text: val['name']
                                          })
                var eventObject = {
                    title: $.trim($(member).text()) // use the element's text as the event title
                };
                $(member).data('eventObject', eventObject);

                $(member).draggable({
                    zIndex: 999,
                    revert: true,      // will cause the event to go back to its
                    revertDuration: 0  //  original position after the drag
                });

                items.push(member);
            });
            $("#team_members").append(items);
        });
    });
</script>
<style>

    body {
        margin-top: 40px;
        text-align: center;
        font-size: 14px;
        font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
        }
        
    #wrap {
        width: 1100px;
        margin: 0 auto;
        }

    #team_members {
        float: left;
        width: 150px;
        padding: 0 10px;
        border: 1px solid #ccc;
        background: #eee;
        text-align: left;
        }

    .team_member { /* try to mimick the look of a real event */
        margin: 10px 0;
        padding: 2px 4px;
        background: #3366CC;
        color: #fff;
        font-size: .85em;
        cursor: pointer;
        }

    #loading {
        position: absolute;
        top: 5px;
        right: 5px;
        }

    #calendar {
        float: right;
        width: 900px;
        margin: 0 auto;
        }

</style>
</head>
<body>
<div id='wrap'>
<div id='team_members'></div>
<div id='loading' style='display:none'>loading...</div>
<div id='calendar'></div>
</div>
</body>
</html>